#!/bin/bash
set -euo pipefail
here=$(dirname "${BASH_SOURCE[0]}")

if [ $# -ne 1 ]; then
  echo >&2 "usage: $0 outputdir"
  exit 1
fi
out=$1

stdenv=()

stdtool() {
  stdenv+=("$out/$1")
}

package() {
  local module
  module=$1
  shift
  "$here"/build "$out/$module" "$here/module/$module" \
    ${stdenv:+"${stdenv[@]}"} ${@:+"${@/#/$out/}"}
}

mkdir -p "$out"
. "$here"/packages
