#!/bin/bash
set -euo pipefail
me=$(basename "${BASH_SOURCE[0]}")
here=$(dirname "${BASH_SOURCE[0]}")
here=$(readlink -f "$here")

if [ $# -ne 1 ]; then
  echo >&2 "usage: $0 outputdir"
  exit 1
fi
out=$(readlink -f "$1")

build() {
  module=$1
  shift
  "$here"/build "$out/$module" "$here/$module" "${@/#/$out/}"
}

mkdir -p "$out"
build ctng
build cross ctng
build cross-native cross ctng
build static-bash cross
build linux cross
build xorriso
build grub xorriso
build tree linux static-bash
build image grub xorriso tree
